<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <script src="./tema.js" defer></script>
  <title>Editar Churrasco</title>

  <script>
    async function loadData() {
      let mySearchParams = new URLSearchParams(document.location.search);
      let idChurrasco = mySearchParams.get("id");

      let data = await fetch("http://localhost:3000/churrascos/${idChurrasco}");
      let churrasco = await data.json();

      document.querySelector("input#idChurrasco").value = idChurrasco;
      document.querySelector("input#data").value = churrasco.dataChurrasco;
      document.querySelector("input#homens").value = churrasco.quantidadeHomens;
      document.querySelector("input#mulheres").value = churrasco.quantidadeMulheres;
      document.querySelector("input#criancas").value = churrasco.quantidadeCriancas;
    }

    window.onload = loadData;
  </script>
</head>

<body class="body">
  <header>
    <p><strong>Tema escuro: </strong></p>
    <div class="container">      
      <div class="btn"></div>
    </div>
  </header>

  <main>
    <section class="textoInical">
      <h1 class="titulo">Churrascômetro</h1>
      <div class="textoApresentacao">
        <p>Precisa de uma ajudinha com o churrasco? :)</p>
        <br>
        <p>Quantas pessoas vão participar?</p>
      </div>
      
    </section>
    <form id="formularioEditar" action="index.html">

        <input type="hidden" id="idChurrasco" />
                

      <div class="input">
        <label for="data"><strong>Data do Churrasco:</strong></label>
        <input id="data" type="date"><br>
      </div>
      
      <div class="input">
        <label for="homens"><strong>Quantidade de Homens:</strong></label>
        <input id="homens" type="number"><br>
      </div>

      <div class="input">
        <label for="mulheres"><strong>Quantidade de Mulheres:</strong></label>
        <input id="mulheres" type="number"><br>
      </div>
      
      <div class="input">
        <label for="criancas"><strong>Quantidade de Crianças:</strong></label>
        <input id="criancas" type="number"><br>
      </div>
      
    </form>

    <div class="btn-editar">
      <button onclick="editarChurrasco()"><strong>Calcular</strong></button>
    </div>
    
  </main>

  

  <script>

    /*function retornar() {
      window.location.href = "/index.html";
    }*/

    async function editarChurrasco(event) {
      event.preventDefault();


      try {

        let data = document.getElementById('data')
        let homens = document.getElementById('homens')
        let mulheres = document.getElementById('mulheres')
        let criancas = document.getElementById('criancas')

        let homensValor = Number(homens.value)
        let mulheresValor = Number(mulheres.value)
        let criancasValor = Number(criancas.value)

        //console.log(homensValor)
        //console.log(mulheresValor)
        //console.log(criancasValor)
        //console.log(data.value)

        const soma = homensValor + mulheresValor + criancasValor;

        /*Calculo*/

        const kgHomem = homensValor * 0.4;
        const kgMulher = mulheresValor * 0.32;
        const kgCrianca = criancasValor * 0.20;

        const somaKgCarne = kgHomem + kgMulher + kgCrianca;

        /*pao de alho*/

        const paoAdulto = (homensValor + mulheresValor) * 2;
        const paoCrianca = criancasValor * 1;

        const somaPaoDeAlho = paoAdulto + paoCrianca;

        /*Carvão*/

        const carvao = (soma * 1)

        /*Refrigerante*/

        let garrafas = Math.ceil(soma / 5);

        /*Cerveja*/

        const cerveja = (homensValor + mulheresValor) * 3;

        let urlParams = new URLSearchParams(window.location.search);
        let id = urlParams.get('id');

        const elementos = {
          id: id,
          quantidadeHomens: homens.value,
          quantidadeMulheres: mulheres.value,
          quantidadeCriancas: criancas.value,
          quantidadePessoas: soma,
          quantidadePaoAlho: somaPaoDeAlho,
          quantidadeCarne: somaKgCarne,
          quantidadeRefri: garrafas,
          quantidadeCerveja: cerveja,
          quantidadeCarvao: carvao,
          dataChurrasco: data.value
        }

        const response = await fetch(`http://localhost:3000/churrascos/${id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(elementos),
        })


        window.location.href = "/index.html";

      } catch (error) {
        console.error('Um erro ocorreu:', error);
      }

    }


  </script>

</body>

</html>